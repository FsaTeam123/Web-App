<!-- src/app/pages/mestrar-secao/mestrar-secao.component.html -->
<app-page-shell [useAltBackground]="true">
  <app-header-fixo shell-header
                   [siteName]="'Reinos Perdidos RPG'"
                   [logoSrc]="'/assets/logo-rpg.png'">
  </app-header-fixo>

  <section class="form-container form-container--xl">
    <h2>Mestrar <span>Sessão</span></h2>

    <!-- mensagens -->
    <p *ngIf="successMsg" class="alert ok">{{ successMsg }}</p>
    <p *ngIf="errorMsg" class="alert err">{{ errorMsg }}</p>

    <div class="form-field">
      <label for="titulo">Título:</label>
      <input id="titulo" type="text" class="form-input"
             [(ngModel)]="titulo" maxlength="30"
             placeholder="Digite o título da sessão">
    </div>

    <!-- Linha com 3 colunas: Qtd + Host + Nível Inicial -->
    <div class="form-row three-col">
      <!-- Quantidade -->
      <div class="form-field form-field--qtd">
        <label for="qtd">Quantidade de pessoas:</label>
        <input id="qtd" type="number" class="form-input"
               [(ngModel)]="qtdPessoas" min="1">
      </div>

      <!-- Host -->
      <div class="form-field form-field--host">
        <label for="tipo-host">Tipo de Host:</label>
        <div class="options-row">
          <label class="option">
            <input type="radio" name="pubPriv" value="publico" [(ngModel)]="publicoPrivado">
            Público
          </label>
          <label class="option">
            <input type="radio" name="pubPriv" value="privado" [(ngModel)]="publicoPrivado">
            Privado
          </label>
        </div>
      </div>

      <!-- Nível inicial -->
      <div class="form-field form-field--nivel">
        <label for="nivel">Nível inicial:</label>
        <input id="nivel" type="number" class="form-input"
               [(ngModel)]="nivelInicial" min="1" max="20">
      </div>
    </div>

    <!-- Linha com 2 colunas: Universo + Estilo de Campanha -->
    <div class="form-row two-col">
      <div class="form-field">
        <label for="universo">Universo:</label>
        <select id="universo" class="form-input select"
                [(ngModel)]="selectedUniversoId">
          <option [ngValue]="undefined">Selecione…</option>
          <option *ngFor="let u of universos" [ngValue]="u.idGeracaoMundo">{{ u.nome }}</option>
        </select>
      </div>
      <div class="form-field">
        <label for="estilo">Estilo de campanha:</label>
        <select id="estilo" class="form-input select"
                [(ngModel)]="selectedEstiloId">
          <option [ngValue]="undefined">Selecione…</option>
          <option *ngFor="let e of estilos" [ngValue]="e.idEstiloCampanha">{{ e.nome }}</option>
        </select>
      </div>
    </div>

    <!-- Linha com 2 colunas: História + Tema -->
    <div class="form-row two-col">
      <div class="form-field">
        <label for="historia">História:</label>
        <select id="historia" class="form-input select"
                [(ngModel)]="selectedHistoriaId">
          <option [ngValue]="undefined">Selecione…</option>
          <option *ngFor="let h of historias" [ngValue]="h.idHistoria">{{ h.nome }}</option>
        </select>
      </div>
      <div class="form-field">
        <label for="tema">Tema:</label>
        <select id="tema" class="form-input select"
                [(ngModel)]="selectedTemaId">
          <option [ngValue]="undefined">Selecione…</option>
          <option *ngFor="let t of temas" [ngValue]="t.idTema">{{ t.nome }}</option>
        </select>
      </div>
    </div>

    <div *ngIf="publicoPrivado === 'privado'" class="form-field form-field--senha form-field--senha-outside">
      <label for="senha" class="senha-label">Senha da sessão</label>
      <input
        id="senha"
        type="password"
        class="form-input senha-input"
        [(ngModel)]="senha"
        placeholder="Defina uma senha"
        autocomplete="new-password"
      >
    </div>

    <div class="form-field">
      <label class="checkbox-line">
        <input type="checkbox" [(ngModel)]="classesEspecificas">
        Classes específicas
      </label>
    </div>

    <!-- SLIDER + FLIP CARD (mantido) -->
    <div class="classes-slider" *ngIf="classesEspecificas && (classes?.length || 0) > 0">

  <div class="card-scene">
    <!-- setas DENTRO do card; stopPropagation pra não virar a carta -->
    <button class="arrow left" (click)="prev(); $event.stopPropagation()">&#10094;</button>

    <!-- Cena 3D: clica para virar -->
    <div class="flip-card" [class.is-flipped]="isFlipped()" (click)="toggleFlip()">
      <!-- Frente -->
      <div class="card-face front">
        <img *ngIf="current?.imagemBase64"
             [src]="'data:' + (current?.imagemContentType || 'image/png') + ';base64,' + current?.imagemBase64"
             [alt]="current?.nome || 'Classe'">
        <div *ngIf="!current?.imagemBase64" class="placeholder"><span>Sem imagem</span></div>
      </div>

      <!-- Verso -->
      <div class="card-face back">
        <div class="card-back-overlay">
          <h3 class="card-title">{{ current?.nome }}</h3>
          <p class="card-desc">{{ current?.descricao }}</p>
          <div class="card-meta">
            <div class="meta-line">
              <span class="meta-label">Pontos de vida inicial:</span>
              <span class="meta-value">{{ currentPvInitLabel }}</span>
            </div>
            <div class="meta-line">
              <span class="meta-label">Pontos de vida por nível:</span>
              <span class="meta-value">{{ currentPvNivelLabel }}</span>
            </div>
            <div class="meta-line">
              <span class="meta-label">Pontos de mana por nível:</span>
              <span class="meta-value">{{ currentPmNivelLabel }}</span>
            </div>
            <div class="meta-line">
              <span class="meta-label">Proeficiências:</span>
              <span class="meta-value">{{ currentProeficienciasText }}</span>
            </div>
            <div class="meta-line">
              <span class="meta-label">Perícias:</span>
              <span class="meta-value">{{ currentPericiasText }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button class="arrow right" (click)="next(); $event.stopPropagation()">&#10095;</button>
  </div>

</div>

    <div class="select-line" *ngIf="classesEspecificas && current">
      <label>
        <input type="checkbox"
               [checked]="selectedIds.has(current.idClasse)"
               (change)="toggleSelect(current.idClasse, $any($event.target).checked)">
        Selecionar esta classe
      </label>
    </div>

    <!-- Botão Criar -->
    <div class="cta-line">
      <button class="btn btn-primary" [disabled]="isSubmitting" (click)="criarSessao()">
        {{ isSubmitting ? 'Criando…' : 'Criar sessão' }}
      </button>
    </div>

  </section>

  <app-footer shell-footer
              [siteName]="'Reinos Perdidos RPG'"
              [teamName]="'Equipe FSA RPG'"
              [leftLogoSrc]="'/assets/logo-fsa.png'">
  </app-footer>
</app-page-shell>
